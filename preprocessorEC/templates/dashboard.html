<!-- preprocessorEC/templates/dashboard.html -->
{% extends 'layout.html' %}

{% block title %}Dashboard - Contract Atlas{% endblock %}

{% block content %}
<div class="dashboard-header">
    <h1>Process Dashboard</h1>
    <p>Current step: <strong>{{ current_step.name }}</strong></p>
</div>

<div class="step-overview">
    <div class="progress-bar">
        {% for step in workflow_steps %}
            {% set is_completed = step.id in completed_steps %}
            {% set is_current = step.id == current_step.id %}
            <div class="progress-segment 
                {% if is_completed %}completed{% endif %}
                {% if is_current %}current{% endif %}">
            </div>
        {% endfor %}
    </div>
    <div class="step-indicators">
        {% for step in workflow_steps %}
            {% set is_completed = step.id in completed_steps %}
            {% set is_current = step.id == current_step.id %}
            <div class="step-indicator">
                <div class="step-number {% if is_completed %}completed{% elif is_current %}current{% endif %}">
                    {{ step.id }}
                </div>
                <div class="step-name">{{ step.name }}</div>
            </div>
        {% endfor %}
    </div>
</div>

<div class="step-details">
    <h2>{{ current_step.name }} (Step {{ current_step.id }})</h2>
    
    {% if current_step.id == 1 %}
        <!-- Pre-Checking Content -->
        <div class="step-content">
            <h3>Step 1.1: Upload Contract Price File</h3>
            <p>Upload your contract price file to begin the pre-checking process. Accepted formats: .xlsx, .csv. Click to download the <a href="{{ url_for('main.download_template') }}" class="template-link">template</a> if needed.</p>
            
            <div id="upload-container">
                <form id="upload-form" enctype="multipart/form-data">
                    <div class="form-group">
                        <label for="file">Select File</label>
                        <input type="file" id="file" name="file" class="form-control-file" accept=".xlsx,.csv" required>
                    </div>
                    <button type="submit" class="btn btn-primary">Upload File</button>
                </form>
            </div>
            
            <div id="mapping-container" style="display:none; margin-top: 20px;">
                <h3 style="font-size: 1.2rem;">Step 1.2: Map File Columns</h3>
                <p style="font-size: 0.9rem;">Please map your file columns to our required fields:</p>
                
                <form id="mapping-form">
                    <div class="compact-form">
                        <div class="row form-row">
                            <div class="col-md-6">
                                <div class="form-group compact-group">
                                    <label class="compact-label">Manufacturer Part Number*:</label>
                                    <select name="Mfg Part Num" class="form-control form-control-sm required-field"></select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group compact-group">
                                    <label class="compact-label">Vendor Part Number*:</label>
                                    <select name="Vendor Part Num" class="form-control form-control-sm required-field"></select>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row form-row">
                            <div class="col-md-6">
                                <div class="form-group compact-group">
                                    <label class="compact-label">Buyer Part Number (Optional):</label>
                                    <select name="Buyer Part Num" class="form-control form-control-sm">
                                        <option value="">Not Available</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group compact-group">
                                    <label class="compact-label">Description*:</label>
                                    <select name="Description" class="form-control form-control-sm required-field"></select>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row form-row">
                            <div class="col-md-6">
                                <div class="form-group compact-group">
                                    <label class="compact-label">Contract Price*:</label>
                                    <select name="Contract Price" class="form-control form-control-sm required-field"></select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group compact-group">
                                    <label class="compact-label">Unit of Measure (UOM)*:</label>
                                    <select name="UOM" class="form-control form-control-sm required-field"></select>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row form-row">
                            <div class="col-md-6">
                                <div class="form-group compact-group">
                                    <label class="compact-label">Quantity of Each (QOE)*:</label>
                                    <select name="QOE" class="form-control form-control-sm required-field"></select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group compact-group">
                                    <label class="compact-label">Effective Date*:</label>
                                    <select name="Effective Date" class="form-control form-control-sm required-field"></select>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row form-row">
                            <div class="col-md-6">
                                <div class="form-group compact-group">
                                    <label class="compact-label">Expiration Date*:</label>
                                    <select name="Expiration Date" class="form-control form-control-sm required-field"></select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group compact-group">
                                    <label class="compact-label">Contract Number*:</label>
                                    <select name="Contract Number" class="form-control form-control-sm required-field"></select>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row form-row">
                            <div class="col-md-6">
                                <div class="form-group compact-group">
                                    <label class="compact-label">ERP Vendor ID*:</label>
                                    <select name="ERP Vendor ID" class="form-control form-control-sm required-field"></select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <!-- Empty column for alignment purposes -->
                            </div>
                        </div>
                    </div>
                    <p><small>* Required fields</small></p>
                    <button type="submit" class="btn btn-primary mb-4">Validate</button>
                    <div class="form-group mt-5" style="margin-top: 20px;">
                        <label><strong>Duplicate Checking Mode:</strong></label>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="duplicate_mode" id="defaultMode" value="default" 
                                   {% if not session.get('duplicate_check_mode') or session.get('duplicate_check_mode') == 'default' %}checked{% endif %}>
                            <label class="form-check-label" for="defaultMode">
                                Default (Contract Number + Reduced Mfg Part Num)
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="duplicate_mode" id="explicitMode" value="explicit"
                                   {% if session.get('duplicate_check_mode') == 'explicit' %}checked{% endif %}>
                            <label class="form-check-label" for="explicitMode">
                                Explicit (Contract Number + Mfg Part Num + UOM)
                            </label>
                        </div>
                        <small class="form-text text-muted">
                            Use explicit mode only after you have first reviewed all your potential duplicates and you are sure they should be identified by their explicit manufacturer part number and UOM.
                        </small>
                    </div>
                </form>
            </div>
            
            <div id="validation-container" style="display:none; margin-top: 20px;">
                <h3>Step 1.3: File Validation</h3>
                <div id="validation-results"></div>
                
                <div id="error-display" style="display:none;">
                    <h4>Validation Errors</h4>
                    <div class="table-responsive-container">
                        <div id="error-table-container"></div>
                    </div>
                    <div class="button-group" style="margin-top: 15px;">
                        <a id="download-error-link" href="{{ url_for('main.download_error_file') }}" class="btn btn-warning">Download Error Report</a>
                        <a href="{{ url_for('main.dashboard', restart=1) }}" class="btn btn-secondary">Start Over</a>
                    </div>
                </div>
                
                <div id="success-display" style="display:none;">
                    <div class="alert alert-success">
                        <h4><i class="icon">✓</i> PASS!</h4>
                        <p>All validation checks have passed successfully.</p>
                    </div>
                    <form method="POST" action="{{ url_for('main.process_step', step_id=1) }}">
                        <button type="submit" class="btn btn-success">Complete Step 1</button>
                    </form>
                </div>
            </div>
        </div>
        
        <script>
            document.addEventListener('DOMContentLoaded', function() {
                // File Upload Form
                document.getElementById('upload-form').addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    const formData = new FormData(this);
                    const uploadBtn = this.querySelector('button[type="submit"]');
                    uploadBtn.disabled = true;
                    uploadBtn.textContent = 'Uploading...';
                    
                    fetch('/upload-file', {
                        method: 'POST',
                        body: formData
                    })
                    .then(response => response.json())
                    .then(data => {
                        uploadBtn.disabled = false;
                        uploadBtn.textContent = 'Upload File';
                        
                        if (data.success) {
                            // Show mapping container
                            document.getElementById('upload-container').innerHTML = `
                                <div class="alert alert-success">
                                    <strong>File uploaded:</strong> ${data.filename}
                                </div>
                            `;
                            
                            // Define column name variations for auto-mapping
                            const columnMappings = {
                                'Mfg Part Num': ['mfg part num', 'mfg part number', 'manufacturer part', 'manufacturer part number', 'mfr part', 'mfrpartnum', 'mfg part #', 'manufacturer part #', 'manufacturer number'],
                                'Vendor Part Num': ['vendor part', 'vendor part num', 'vendor part number', 'supplier part', 'supplierpartnum', 'vendor part #', 'supplier part #', 'vendor item'],
                                'Buyer Part Num': ['buyer part', 'buyer part num', 'buyer part number', 'customer part', 'customerpartnum', 'buyer part #', 'customer part #'],
                                'Description': ['description', 'desc', 'item desc', 'product desc', 'item description'],
                                'Contract Price': ['contract price', 'price', 'unit price', 'cost', 'contract cost'],
                                'UOM': ['uom', 'unit of measure', 'unit', 'measure', 'unit measure'],
                                'QOE': ['qoe', 'quantity of each', 'qty each', 'package qty', 'qty per package'],
                                'Effective Date': ['effective date', 'start date', 'valid from', 'start', 'begin date'],
                                'Expiration Date': ['expiration date', 'exp date', 'end date', 'valid until', 'termination date'],
                                'Contract Number': ['contract number', 'contract num', 'contract #', 'contract id', 'agreement number'],
                                'ERP Vendor ID': ['erp vendor id', 'vendor id', 'supplier id', 'erp supplier', 'vendor code']
                            };
                            
                            // Normalize headers to lowercase for matching
                            const normalizedHeaders = data.headers.map(h => h.toLowerCase());
                            
                            // Auto-map columns based on similar names
                            const autoMappings = {};
                            let unmatchedFields = 0;
                            
                            // Populate dropdowns with file headers
                            const selects = document.querySelectorAll('#mapping-form select');
                            selects.forEach(select => {
                                // Clear any existing options
                                select.innerHTML = '';
                                
                                // Add empty option
                                const emptyOption = document.createElement('option');
                                emptyOption.value = '';
                                emptyOption.textContent = '-- Select Column --';
                                select.appendChild(emptyOption);
                                
                                // Add headers as options
                                data.headers.forEach(header => {
                                    const option = document.createElement('option');
                                    option.value = header;
                                    option.textContent = header;
                                    select.appendChild(option);
                                });
                                
                                // Try to auto-match this field
                                const fieldName = select.name;
                                if (columnMappings[fieldName]) {
                                    // Look for a match in the uploaded headers
                                    let bestMatch = null;
                                    
                                    // First try exact match
                                    const exactMatch = normalizedHeaders.findIndex(h => 
                                        columnMappings[fieldName].includes(h));
                                    
                                    if (exactMatch !== -1) {
                                        bestMatch = data.headers[exactMatch];
                                    } else {
                                        // Try partial match
                                        for (let i = 0; i < normalizedHeaders.length; i++) {
                                            for (let j = 0; j < columnMappings[fieldName].length; j++) {
                                                if (normalizedHeaders[i].includes(columnMappings[fieldName][j]) || 
                                                    columnMappings[fieldName][j].includes(normalizedHeaders[i])) {
                                                    bestMatch = data.headers[i];
                                                    break;
                                                }
                                            }
                                            if (bestMatch) break;
                                        }
                                    }
                                    
                                    if (bestMatch) {
                                        select.value = bestMatch;
                                        autoMappings[fieldName] = bestMatch;
                                        
                                        // Add visual indicator for auto-matched fields
                                        const parentDiv = select.closest('.form-group');
                                        parentDiv.classList.add('auto-matched');
                                        const label = parentDiv.querySelector('label');
                                        label.innerHTML += ' <span class="auto-match-indicator">(Auto-matched)</span>';
                                    } else if (select.classList.contains('required-field')) {
                                        unmatchedFields++;
                                    }
                                }
                            });
                            
                            // Show mapping container with a message about auto-matching
                            document.getElementById('mapping-container').style.display = 'block';
                            
                            // Add notification about auto-matching
                            const mappingForm = document.getElementById('mapping-form');
                            const autoMapNotice = document.createElement('div');
                            autoMapNotice.className = 'alert alert-info';
                            
                            if (Object.keys(autoMappings).length > 0) {
                                autoMapNotice.innerHTML = `
                                    <strong>Auto-matched ${Object.keys(autoMappings).length} columns.</strong> 
                                    ${unmatchedFields > 0 ? 'Please review and complete the ' + unmatchedFields + ' remaining required fields.' : 'All required fields were matched! Please review and confirm.'}
                                `;
                                mappingForm.insertBefore(autoMapNotice, mappingForm.firstChild);
                            }
                        } else {
                            alert('Error: ' + data.message);
                        }
                    })
                    .catch(error => {
                        uploadBtn.disabled = false;
                        uploadBtn.textContent = 'Upload File';
                        alert('Error uploading file: ' + error);
                    });
                });

           
                
                // Column Mapping Form
                document.getElementById('mapping-form').addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    // Validate that all required fields are mapped
                    const requiredSelects = document.querySelectorAll('.required-field');
                    let isValid = true;
                    
                    requiredSelects.forEach(select => {
                        if (!select.value) {
                            isValid = false;
                            select.classList.add('is-invalid');
                        } else {
                            select.classList.remove('is-invalid');
                        }
                    });
                    
                    if (!isValid) {
                        alert('Please map all required fields');
                        return;
                    }
                    
                    const formData = new FormData(this);
                    const mappingBtn = this.querySelector('button[type="submit"]');
                    mappingBtn.disabled = true;
                    mappingBtn.textContent = 'Processing...';
                    
                    // First save the column mapping
                    fetch('/map-columns', {
                        method: 'POST',
                        body: formData
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            // Now validate the file
                            return fetch('/validate-file', {
                                method: 'POST',
                                body: formData
                            });
                        } else {
                            throw new Error(data.message);
                        }
                    })
                    .then(response => response.json())
                    .then(data => {
                        mappingBtn.disabled = false;
                        mappingBtn.textContent = 'Validate';
                        
                        document.getElementById('validation-container').style.display = 'block';
                        
                        if (data.success) {
                            // Show success message
                            document.getElementById('validation-results').innerHTML = `
                                <div class="alert alert-success">${data.message}</div>
                            `;
                            document.getElementById('error-display').style.display = 'none';
                            document.getElementById('success-display').style.display = 'block';
                        } else {
                            // Show error message and table
                            document.getElementById('validation-results').innerHTML = `
                                <div class="alert alert-danger">${data.message}</div>
                            `;
                            document.getElementById('error-table-container').innerHTML = data.error_table;
                            const table = document.querySelector('#error-table-container table');
                            if (table) {
                                table.style.width = 'max-content';
                                table.style.minwidth = '100%';
                            }
                            document.getElementById('error-display').style.display = 'block';
                            document.getElementById('success-display').style.display = 'none';
                            
                            // Add styles to highlight error rows
                            const errorTable = document.querySelector('#error-table-container table');
                            if (errorTable) {
                                const rows = errorTable.querySelectorAll('tbody tr');
                                rows.forEach(row => {
                                    row.style.backgroundColor = '#fee';
                                });
                            }
                        }
                    })
                    .catch(error => {
                        mappingBtn.disabled = false;
                        mappingBtn.textContent = 'Validate';
                        alert('Error: ' + error.message);
                    });
                });
            });
        </script>
    
    {% elif current_step.id == 2 %}
        <!-- Duplication Overview Content -->
        <div class="step-content">
            <p>Review the identified duplications in your data.</p>
            <div class="data-table">
                <table>
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Item</th>
                            <th>Duplicates Found</th>
                            <th>Confidence</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Sample data - would be populated dynamically -->
                        <tr>
                            <td>1001</td>
                            <td>Item A</td>
                            <td>3</td>
                            <td>High</td>
                        </tr>
                        <tr>
                            <td>1002</td>
                            <td>Item B</td>
                            <td>2</td>
                            <td>Medium</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <form method="POST" action="{{ url_for('main.process_step', step_id=2) }}">
                <button type="submit" class="btn btn-primary">Continue to Resolution</button>
            </form>
        </div>
        
    {% elif current_step.id == 3 %}
        <!-- Duplication Resolution Content -->
        <div class="step-content">
            <p>Resolve the identified duplications.</p>
            <div class="resolution-controls">
                <form method="POST" action="{{ url_for('main.process_step', step_id=3) }}">
                    <!-- Resolution UI would go here -->
                    <div class="form-group">
                        <label>Resolution Strategy</label>
                        <select class="form-control" name="resolution_strategy">
                            <option value="merge">Merge Duplicates</option>
                            <option value="keep_latest">Keep Latest</option>
                            <option value="manual">Manual Resolution</option>
                        </select>
                    </div>
                    <button type="submit" class="btn btn-primary">Apply Resolution</button>
                </form>
            </div>
        </div>
        
    {% elif current_step.id == 4 %}
        <!-- Item Master Matching Content -->
        <div class="step-content">
            <p>Match items to the master database.</p>
            <div class="matching-table">
                <!-- Matching interface would go here -->
                <form method="POST" action="{{ url_for('main.process_step', step_id=4) }}">
                    <div class="form-group">
                        <label>Matching Method</label>
                        <select class="form-control" name="matching_method">
                            <option value="exact">Exact Match</option>
                            <option value="fuzzy">Fuzzy Match</option>
                            <option value="manual">Manual Match</option>
                        </select>
                    </div>
                    <button type="submit" class="btn btn-primary">Complete Matching</button>
                </form>
            </div>
        </div>
        
    {% elif current_step.id == 5 %}
        <!-- Change Simulation Content -->
        <div class="step-content">
            <p>Review the simulated changes before applying.</p>
            <div class="simulation-results">
                <!-- Simulation data would go here -->
                <div class="stats-summary">
                    <div class="stat-box">
                        <div class="stat-number">42</div>
                        <div class="stat-label">Items to Update</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-number">7</div>
                        <div class="stat-label">Items to Create</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-number">3</div>
                        <div class="stat-label">Items to Delete</div>
                    </div>
                </div>
                <form method="POST" action="{{ url_for('main.process_step', step_id=5) }}">
                    <button type="submit" class="btn btn-primary">Approve Changes</button>
                </form>
            </div>
        </div>
        
    {% elif current_step.id == 6 %}
        <!-- Export Changes Content -->
        <div class="step-content">
            <p>Export the approved changes.</p>
            <div class="export-options">
                <form method="POST" action="{{ url_for('main.process_step', step_id=6) }}">
                    <div class="form-group">
                        <label>Export Format</label>
                        <select class="form-control" name="export_format">
                            <option value="csv">CSV</option>
                            <option value="excel">Excel</option>
                            <option value="json">JSON</option>
                        </select>
                    </div>
                    <button type="submit" class="btn btn-primary">Export Now</button>
                </form>
            </div>
        </div>
        
    {% elif current_step.id == 7 %}
        <!-- Synchronization Inspection Content -->
        <div class="step-content">
            <p>Inspect the synchronization status.</p>
            <div class="sync-status">
                <div class="status-indicator success">
                    <span class="icon">✓</span>
                    <span class="text">Synchronization Complete</span>
                </div>
                <div class="sync-details">
                    <p><strong>Total Items:</strong> 52</p>
                    <p><strong>Successfully Synced:</strong> 52</p>
                    <p><strong>Sync Time:</strong> 2023-06-01 14:32:45</p>
                </div>
                <form method="POST" action="{{ url_for('main.process_step', step_id=7) }}">
                    <button type="submit" class="btn btn-primary">Verify and Continue</button>
                </form>
            </div>
        </div>
        
    {% elif current_step.id == 8 %}
        <!-- Completion Verified Content -->
        <div class="step-content">
            <p>The process has been completed and verified.</p>
            <div class="completion-summary">
                <div class="completion-icon">✓</div>
                <h3>Process Successfully Completed</h3>
                <p>All steps have been completed and the changes have been applied.</p>
                <div class="summary-details">
                    <p><strong>Process ID:</strong> #12345</p>
                    <p><strong>Completed On:</strong> 2023-06-01 15:00:00</p>
                    <p><strong>Processed Items:</strong> 52</p>
                </div>
                <a href="{{ url_for('main.index') }}" class="btn btn-primary">Return to Home</a>
                <a href="{{ url_for('main.dashboard', restart=1) }}" class="btn btn-secondary">Start New Process</a>
            </div>
        </div>
    {% endif %}
</div>

{% endblock %}

{% block extra_styles %}
<style>
    .dashboard-header {
        margin-bottom: 30px;
    }

    .step-overview {
        margin-bottom: 40px;
    }

    .progress-bar {
        display: flex;
        height: 10px;
        background-color: #e9ecef;
        border-radius: 5px;
        margin-bottom: 10px;
    }

    .progress-segment {
        flex: 1;
        height: 100%;
        margin: 0 1px;
    }

    .progress-segment.completed {
        background-color: #2ecc71;
    }

    .progress-segment.current {
        background-color: #3498db;
    }

    .step-indicators {
        display: flex;
        justify-content: space-between;
    }

    .step-indicator {
        text-align: center;
        width: 80px;
    }

    .step-number {
        width: 30px;
        height: 30px;
        border-radius: 50%;
        background-color: #e9ecef;
        color: #333;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 5px auto;
    }

    .step-number.completed {
        background-color: #2ecc71;
        color: white;
    }

    .step-number.current {
        background-color: #3498db;
        color: white;
    }

    .step-name {
        font-size: 0.8em;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    .step-details {
        background-color: #f8f9fa;
        border-radius: 8px;
        padding: 25px;
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }

    .step-content {
        margin-top: 20px;
    }

    .btn {
        display: inline-block;
        padding: 10px 20px;
        border-radius: 4px;
        text-decoration: none;
        font-weight: bold;
        margin-top: 15px;
        cursor: pointer;
        border: none;
    }

    .btn-primary {
        background-color: #3498db;
        color: white;
    }

    .btn-secondary {
        background-color: #95a5a6;
        color: white;
    }

    .form-group {
        margin-bottom: 15px;
    }

    .form-control {
        width: 100%;
        padding: 8px 12px;
        border: 1px solid #ced4da;
        border-radius: 4px;
    }

    .data-table table {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 20px;
    }

    .data-table th, .data-table td {
        padding: 12px;
        text-align: left;
        border-bottom: 1px solid #e9ecef;
    }

    .data-table th {
        background-color: #f8f9fa;
        font-weight: bold;
    }

    .stats-summary {
        display: flex;
        justify-content: space-around;
        margin: 20px 0;
    }

    .stat-box {
        text-align: center;
        padding: 15px;
        background-color: #fff;
        border-radius: 4px;
        box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }

    .stat-number {
        font-size: 2em;
        font-weight: bold;
        color: #3498db;
    }

    .stat-label {
        margin-top: 5px; /* form styles */
        color: #7f8c8d;
    }

    .row {
        display: flex;
        flex-wrap: wrap;
        margin-right: -15px;
        margin-left: -15px;
    }

    .col-md-6 {
        flex: 0 0 50%;
        max-width: 50%;
        padding-right: 15px;
        padding-left: 15px;
        box-sizing: border-box;
    }

/* For mobile responsiveness */
@media (max-width: 991px) {
    .col-md-6 {
        flex: 0 0 100%;
        max-width: 100%;
    }
}

    .compact-group {
        margin-bottom: 8px;
    }
    
    .compact-label {
        font-size: 0.85rem;
        margin-bottom: 2px;
        display: block;
    }
    
    .form-control-sm {
        height: calc(1.5em + 0.5rem + 2px);
        padding: 0.25rem 0.5rem;
        font-size: 0.875rem;
        line-height: 1.5;
        border-radius: 0.2rem;
    }
    
    .btn-sm {
        padding: 0.25rem 0.5rem;
        font-size: 0.875rem;
        line-height: 1.5;
        border-radius: 0.2rem;
    }

    .auto-matched {
    background-color: #f0f9ff;
    padding: 5px;
    border-radius: 4px;
    border-left: 3px solid #3498db;
    }

    .auto-match-indicator {
        color: #3498db;
        font-size: 0.7rem;
        font-weight: normal;
        margin-left: 5px;
    }

    .table-responsive-container {
        max-height: 500px;
        overflow-y: auto;
        overflow-x: auto;
        margin-bottom: 15px;
        border: 1px solid #dee2e6;
        border-radius: 4px;
        background-color: white;
    }

    .table-responsive-container table {
        width: 100%;
        margin-bottom: 0;
        font-size: 0.85rem;
    }

    .table-responsive-container th {
        position: sticky;
        top: 0;
        background-color: #f8f9fa;
        z-index: 10;
        border-bottom: 2px solid #dee2e6;
    }

    .table-responsive-container td, 
    .table-responsive-container th {
        white-space: nowrap;
        padding: 6px 10px;
        border: 1px solid #dee2e6;
    }

    .table-responsive-container tbody tr:nth-of-type(odd) {
        background-color: rgba(0,0,0,.05);
    }

    .table-responsive-container tbody tr:hover {
        background-color: rgba(0,0,0,.075);
    }

    .form-check-label {
        font-size: 0.95rem; /* Smaller font size */
    }

    /* Control width of Description column specifically */
    #error_table td:nth-child(5),
    #error_table th:nth-child(5) {
        max-width: 100px !important;
        width: 100px !important;
        overflow: hidden !important;
        text-overflow: ellipsis !important;
        white-space: nowrap !important;
    }
    
    .table-responsive-container th {
        text-align: center !important;
    }

    /* Template link styling */
    .template-link {
        color: #3498db;
        font-weight: 500;
        text-decoration: underline;
    }
    
    .template-link:hover {
        color: #2980b9;
        text-decoration: underline;
    }

</style>
{% endblock %}
